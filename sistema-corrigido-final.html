<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pontua√ß√£o - Luiza e Miguel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            color: white;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .header .datetime {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 10px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #f44336;
        }
        
        .child-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .child-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .child-btn.active {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
            transform: scale(1.05);
        }
        
        .child-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.02);
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .tab-btn.active {
            background: rgba(255,255,255,0.4);
            transform: scale(1.05);
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tab-content {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }
        
        .tab-content.hidden {
            display: none;
        }
        
        .config-section {
            margin-bottom: 30px;
        }
        
        .config-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .form-group {
            display: flex;
            gap: 20px;
            align-items: end;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .form-field {
            flex: 1;
            min-width: 200px;
        }
        
        .form-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        .form-field input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-field input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn.secondary {
            background: #2196F3;
        }
        
        .btn.secondary:hover {
            background: #1976D2;
        }
        
        .btn.danger {
            background: #f44336;
        }
        
        .btn.danger:hover {
            background: #d32f2f;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .activities-section {
            margin-top: 30px;
        }
        
        .activities-section h3 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .activities-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .activity-item:last-child {
            margin-bottom: 0;
        }
        
        .activity-info {
            flex: 1;
        }
        
        .activity-name {
            font-weight: bold;
            color: #333;
        }
        
        .activity-points {
            color: #666;
            font-size: 0.9rem;
        }
        
        .activity-actions {
            display: flex;
            gap: 5px;
        }
        
        .activity-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .activity-btn:hover {
            transform: scale(1.1);
        }
        
        .activity-btn.add {
            background: #4CAF50;
        }
        
        .activity-btn.remove {
            background: #f44336;
        }
        
        .activity-btn.edit {
            background: #FF9800;
        }
        
        .activity-btn.delete {
            background: #9E9E9E;
        }
        
        .activity-btn.move {
            background: #9C27B0;
            font-size: 0.8rem;
            padding: 6px 8px;
        }
        
        .multiplier-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .multiplier-item {
            text-align: center;
        }
        
        .multiplier-item h5 {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .multiplier-item input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .category-section {
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .category-header {
            padding: 15px 20px;
            color: white;
            text-align: center;
        }
        
        .category-header h4 {
            margin: 0;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        
        .positivos .category-header h4 { background: #4CAF50; } /* Verde */
        .especiais .category-header h4 { background: #2196F3; } /* Azul */
        .negativos .category-header h4 { background: #F44336; } /* Vermelho */
        .graves .category-header h4 { background: #9C27B0; } /* Roxo */
        
        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #eee;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-info {
            flex: 1;
        }
        
        .activity-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .activity-points {
            color: #666;
            font-size: 0.9rem;
        }
        
        .activity-actions {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .activity-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            min-width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .activity-btn:hover {
            transform: scale(1.1);
        }
        
        .activity-btn.add { background: #4CAF50; }
        .activity-btn.remove { background: #f44336; }
        .activity-btn.edit { background: #FF9800; }
        .activity-btn.delete { background: #9E9E9E; }
        .activity-btn.move { 
            background: #9C27B0; 
            font-size: 0.8rem;
            min-width: 30px;
            height: 30px;
        }
        
        .add-activity-btn {
            width: 100%;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .add-activity-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .modal .form-group {
            margin-bottom: 20px;
        }
        
        .modal label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        .modal input, .modal select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .modal input:focus, .modal select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }
        
        .close:hover {
            color: #333;
        }
        
        .reports-section {
            margin-bottom: 30px;
        }
        
        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .period-btn {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            color: #667eea;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .period-btn.active {
            background: #667eea;
            color: white;
        }
        
        .period-btn:hover {
            background: rgba(102, 126, 234, 0.2);
        }
        
        .period-btn.active:hover {
            background: #5a6fd8;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chart-canvas {
            width: 100%;
            height: 300px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-item h5 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .stat-item .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .backup-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .backup-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .backup-status {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
            margin-top: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .file-label:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .form-group {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .multiplier-config {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .activity-actions {
                flex-wrap: wrap;
            }
            
            .modal-content {
                margin: 5% auto;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÜ Sistema de Pontua√ß√£o Avan√ßado</h1>
        <div class="subtitle">Luiza e Miguel - Incentivando bons comportamentos!</div>
        <div class="datetime" id="current-datetime"></div>
    </div>

    <div class="notification" id="notification"></div>

    <div class="child-selector">
        <button class="child-btn active" onclick="selectChild('luiza')">üëß Luiza</button>
        <button class="child-btn" onclick="selectChild('miguel')">üë¶ Miguel</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('dashboard')">üìä Dashboard</button>
        <button class="tab-btn" onclick="showTab('activities')">üéØ Atividades</button>
        <button class="tab-btn" onclick="showTab('reports')">üìà Relat√≥rios</button>
        <button class="tab-btn" onclick="showTab('config')">‚öôÔ∏è Configura√ß√µes</button>
    </div>

    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <div class="config-section">
                <h3>üîß Configura√ß√£o de Saldo Inicial</h3>
                <div class="form-group">
                    <div class="form-field">
                        <label>Saldo Inicial (pontos):</label>
                        <input type="number" id="initial-balance" placeholder="Ex: 100">
                    </div>
                    <div class="form-field">
                        <label>Data de In√≠cio:</label>
                        <input type="date" id="start-date">
                    </div>
                    <button class="btn" onclick="setInitialBalance()">Definir Saldo Inicial</button>
                </div>
                <div id="balance-status">Status: N√£o configurado</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Pontos Totais</h4>
                    <div class="value" id="total-points">0</div>
                </div>
                <div class="stat-card">
                    <h4>Saldo Dispon√≠vel</h4>
                    <div class="value" id="available-balance">R$ 0,00</div>
                </div>
                <div class="stat-card">
                    <h4>Pontos Este M√™s</h4>
                    <div class="value" id="month-points">0</div>
                </div>
                <div class="stat-card">
                    <h4>Gastos Este M√™s</h4>
                    <div class="value" id="month-expenses">R$ 0,00</div>
                </div>
            </div>

            <div class="activities-section">
                <h3>üìÖ Atividades de Hoje</h3>
                <div id="today-activities" class="activities-list">
                    Nenhuma atividade registrada hoje
                </div>
            </div>
        </div>

        <!-- Activities Tab -->
        <div id="activities-tab" class="tab-content hidden">
            <div class="config-section">
                <h3>‚öôÔ∏è Configura√ß√£o de Multiplicadores por Categoria</h3>
                <div class="multiplier-config">
                    <div class="multiplier-item">
                        <h5 style="color: #4CAF50;">Positivos</h5>
                        <input type="number" id="mult-positivos" value="1" min="1" onchange="updateMultiplier('positivos', this.value)">
                    </div>
                    <div class="multiplier-item">
                        <h5 style="color: #2196F3;">Especiais</h5>
                        <input type="number" id="mult-especiais" value="50" min="1" onchange="updateMultiplier('especiais', this.value)">
                    </div>
                    <div class="multiplier-item">
                        <h5 style="color: #F44336;">Negativos</h5>
                        <input type="number" id="mult-negativos" value="1" min="1" onchange="updateMultiplier('negativos', this.value)">
                    </div>
                    <div class="multiplier-item">
                        <h5 style="color: #9C27B0;">Graves</h5>
                        <input type="number" id="mult-graves" value="100" min="1" onchange="updateMultiplier('graves', this.value)">
                    </div>
                </div>
                <button class="btn" onclick="updateAllMultipliers()">Atualizar Multiplicadores</button>
            </div>

            <div id="activities-container">
                <!-- Activities will be loaded here -->
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content hidden">
            <div class="reports-section">
                <h3>üìä An√°lise Temporal</h3>
                <div class="period-selector">
                    <button class="period-btn active" onclick="selectPeriod('week')">√öltima Semana</button>
                    <button class="period-btn" onclick="selectPeriod('month')">√öltimo M√™s</button>
                    <button class="period-btn" onclick="selectPeriod('6months')">√öltimos 6 Meses</button>
                    <button class="period-btn" onclick="selectPeriod('year')">√öltimo Ano</button>
                </div>
                
                <div class="chart-container">
                    <canvas id="evolution-chart" class="chart-canvas"></canvas>
                </div>
                
                <div class="stats-container">
                    <div class="stat-item">
                        <h5>Total de Atividades</h5>
                        <div class="value" id="period-activities">0</div>
                    </div>
                    <div class="stat-item">
                        <h5>Pontos no Per√≠odo</h5>
                        <div class="value" id="period-points">0</div>
                    </div>
                    <div class="stat-item">
                        <h5>M√©dia Di√°ria</h5>
                        <div class="value" id="daily-average">0</div>
                    </div>
                </div>
                
                <div class="stats-container" id="category-analysis">
                    <!-- Category analysis will be loaded here -->
                </div>
                
                <div class="stat-item">
                    <h5>Top 5 Atividades Mais Realizadas</h5>
                    <div id="top-activities"></div>
                </div>
            </div>
        </div>

        <!-- Config Tab -->
        <div id="config-tab" class="tab-content hidden">
            <div class="backup-section">
                <h3>üíæ Sistema de Backup Autom√°tico</h3>
                <div class="backup-controls">
                    <button class="btn" onclick="selectBackupFolder()">üìÅ Selecionar Pasta de Backup</button>
                    <button class="btn secondary" onclick="manualBackup()">üíæ Backup Manual</button>
                    <button class="btn secondary" onclick="exportData()">üì§ Exportar Dados</button>
                    <label for="import-file" class="file-label">üì• Importar Dados</label>
                    <input type="file" id="import-file" class="file-input" accept=".json" onchange="importData(event)">
                </div>
                
                <div class="form-group">
                    <div class="form-field">
                        <label>Intervalo de Backup Autom√°tico:</label>
                        <select id="backup-interval" onchange="setBackupInterval(this.value)">
                            <option value="30">30 segundos</option>
                            <option value="60">1 minuto</option>
                            <option value="300" selected>5 minutos</option>
                            <option value="600">10 minutos</option>
                            <option value="1800">30 minutos</option>
                        </select>
                    </div>
                </div>
                
                <div class="backup-status" id="backup-status">
                    <strong>Status:</strong> Aguardando configura√ß√£o de pasta<br>
                    <strong>√öltimo backup:</strong> Nunca
                </div>
            </div>
            
            <div class="config-section">
                <h3>üìä Estat√≠sticas do Sistema</h3>
                <div id="system-stats"></div>
            </div>
        </div>
    </div>

    <!-- Add Activity Modal -->
    <div id="add-activity-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-activity-modal')">&times;</span>
            <h3>Adicionar Atividade</h3>
            <div class="form-group">
                <label>Nome da Atividade:</label>
                <input type="text" id="activity-name" placeholder="Ex: Escovar os dentes">
            </div>
            <div class="form-group">
                <label>Pontos Base (ser√° multiplicado pelo multiplicador da categoria):</label>
                <input type="number" id="activity-points" value="1" min="1">
            </div>
            <div class="form-group">
                <label>Categoria:</label>
                <select id="activity-category">
                    <option value="positivos">Positivos</option>
                    <option value="especiais">Especiais</option>
                    <option value="negativos">Negativos</option>
                    <option value="graves">Graves</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="saveActivity()">Salvar</button>
                <button class="btn secondary" onclick="closeModal('add-activity-modal')">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Edit Activity Modal -->
    <div id="edit-activity-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('edit-activity-modal')">&times;</span>
            <h3>Editar Atividade</h3>
            <div class="form-group">
                <label>Nome da Atividade:</label>
                <input type="text" id="edit-activity-name">
            </div>
            <div class="form-group">
                <label>Pontos Base:</label>
                <input type="number" id="edit-activity-points" min="1">
            </div>
            <div class="form-group">
                <label>Categoria:</label>
                <select id="edit-activity-category">
                    <option value="positivos">Positivos</option>
                    <option value="especiais">Especiais</option>
                    <option value="negativos">Negativos</option>
                    <option value="graves">Graves</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="saveEditedActivity()">Salvar</button>
                <button class="btn secondary" onclick="closeModal('edit-activity-modal')">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentChild = 'luiza';
        let currentPeriod = 'week';
        let editingActivityId = null;
        let editingCategory = null;
        let backupInterval = null;
        let backupFolderHandle = null;
        
        // System data structure
        let systemData = {
            luiza: {
                initialBalance: 0,
                startDate: null,
                totalPoints: 0,
                activities: [],
                customActivities: {
                    positivos: [
                        {id: 1, name: 'Escovar os dentes', points: 1},
                        {id: 2, name: 'Arrumar a cama', points: 1},
                        {id: 3, name: 'Fazer li√ß√£o de casa', points: 2},
                        {id: 4, name: 'Ajudar a organizar brinquedos', points: 1}
                    ],
                    especiais: [
                        {id: 1, name: 'Ajudar em casa sem pedir', points: 1},
                        {id: 2, name: 'Nota boa na escola', points: 2},
                        {id: 3, name: 'Comportamento exemplar', points: 1}
                    ],
                    negativos: [
                        {id: 1, name: 'N√£o escovar os dentes', points: 1},
                        {id: 2, name: 'Bagun√ßar o quarto', points: 1},
                        {id: 3, name: 'N√£o fazer li√ß√£o de casa', points: 2}
                    ],
                    graves: [
                        {id: 1, name: 'Mentir', points: 1},
                        {id: 2, name: 'Desrespeitar os pais', points: 1},
                        {id: 3, name: 'Brigar com irm√£o', points: 1}
                    ]
                }
            },
            miguel: {
                initialBalance: 0,
                startDate: null,
                totalPoints: 0,
                activities: [],
                customActivities: {
                    positivos: [
                        {id: 1, name: 'Escovar os dentes', points: 1},
                        {id: 2, name: 'Arrumar a cama', points: 1},
                        {id: 3, name: 'Fazer li√ß√£o de casa', points: 2},
                        {id: 4, name: 'Ajudar a organizar brinquedos', points: 1}
                    ],
                    especiais: [
                        {id: 1, name: 'Ajudar em casa sem pedir', points: 1},
                        {id: 2, name: 'Nota boa na escola', points: 2},
                        {id: 3, name: 'Comportamento exemplar', points: 1}
                    ],
                    negativos: [
                        {id: 1, name: 'N√£o escovar os dentes', points: 1},
                        {id: 2, name: 'Bagun√ßar o quarto', points: 1},
                        {id: 3, name: 'N√£o fazer li√ß√£o de casa', points: 2}
                    ],
                    graves: [
                        {id: 1, name: 'Mentir', points: 1},
                        {id: 2, name: 'Desrespeitar os pais', points: 1},
                        {id: 3, name: 'Brigar com irm√£o', points: 1}
                    ]
                }
            },
            multipliers: {
                positivos: 1,
                especiais: 50,
                negativos: 1,
                graves: 100
            }
        };

        // Initialize system
        function initSystem() {
            console.log('üöÄ Inicializando Sistema Avan√ßado...');
            loadData();
            updateDateTime();
            updateDisplay();
            updateActivitiesDisplay();
            showNotification('Sistema Final carregado com sucesso!');
            
            // Update datetime every second
            setInterval(updateDateTime, 1000);
            
            // Auto-save every 30 seconds
            setInterval(saveData, 30000);
            
            console.log('‚úÖ Sistema inicializado com sucesso');
        }

        // Update current date and time
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('current-datetime').textContent = 
                now.toLocaleDateString('pt-BR', options);
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Select child
        function selectChild(child) {
            currentChild = child;
            
            // Update UI
            document.querySelectorAll('.child-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateDisplay();
            updateActivitiesDisplay();
            
            const childName = child === 'luiza' ? 'Luiza' : 'Miguel';
            showNotification(`Selecionado: ${childName}`);
        }

        // Show tab
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            event.target.classList.add('active');
            
            // Load specific tab content
            if (tabName === 'reports') {
                loadReports();
            } else if (tabName === 'config') {
                loadSystemStats();
            }
        }

        // Set initial balance
        function setInitialBalance() {
            const balance = parseInt(document.getElementById('initial-balance').value);
            const startDate = document.getElementById('start-date').value;
            
            if (!balance || !startDate) {
                showNotification('Por favor, preencha todos os campos', 'error');
                return;
            }
            
            systemData[currentChild].initialBalance = balance;
            systemData[currentChild].startDate = startDate;
            systemData[currentChild].totalPoints = balance;
            
            saveData();
            updateDisplay();
            
            const childName = currentChild === 'luiza' ? 'Luiza' : 'Miguel';
            showNotification(`Saldo inicial definido para ${childName}: ${balance} pontos`);
        }

        // Update display
        function updateDisplay() {
            const data = systemData[currentChild];
            
            // Update stats
            document.getElementById('total-points').textContent = data.totalPoints;
            document.getElementById('available-balance').textContent = `R$ ${(data.totalPoints * 0.01).toFixed(2)}`;
            
            // Update balance status
            const status = data.startDate ? 
                `Configurado: ${data.initialBalance} pontos desde ${new Date(data.startDate).toLocaleDateString('pt-BR')}` : 
                'N√£o configurado';
            document.getElementById('balance-status').textContent = `Status: ${status}`;
            
            // Update initial balance fields
            if (data.initialBalance) {
                document.getElementById('initial-balance').value = data.initialBalance;
            }
            if (data.startDate) {
                document.getElementById('start-date').value = data.startDate;
            }
            
            // Update today's activities
            updateTodayActivities();
            
            // Update monthly stats
            updateMonthlyStats();
        }

        // Update today's activities
        function updateTodayActivities() {
            const today = new Date().toISOString().split('T')[0];
            const todayActivities = systemData[currentChild].activities.filter(a => a.date === today);
            
            const container = document.getElementById('today-activities');
            
            if (todayActivities.length === 0) {
                container.innerHTML = 'Nenhuma atividade registrada hoje';
                return;
            }
            
            container.innerHTML = todayActivities.map((activity, index) => `
                <div class="activity-item">
                    <div class="activity-info">
                        <div class="activity-name">${activity.name} (${activity.points > 0 ? '+' : ''}${activity.points} pontos) - ${new Date(activity.timestamp).toLocaleTimeString('pt-BR')}</div>
                    </div>
                    <div class="activity-actions">
                        <button class="activity-btn danger" onclick="removeTodayActivity(${index})">Remover</button>
                    </div>
                </div>
            `).join('');
        }

        // Update monthly stats
        function updateMonthlyStats() {
            const now = new Date();
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            
            const monthActivities = systemData[currentChild].activities.filter(a => 
                new Date(a.date) >= startOfMonth
            );
            
            const monthPoints = monthActivities.reduce((sum, a) => sum + a.points, 0);
            
            document.getElementById('month-points').textContent = monthPoints;
            document.getElementById('month-expenses').textContent = 'R$ 0,00'; // Placeholder for expenses
        }

        // Update multiplier
        function updateMultiplier(category, value) {
            systemData.multipliers[category] = parseInt(value);
            saveData();
            updateActivitiesDisplay();
            showNotification(`Multiplicador ${category} atualizado para ${value}x`);
        }

        // Update all multipliers
        function updateAllMultipliers() {
            const positivos = document.getElementById('mult-positivos').value;
            const especiais = document.getElementById('mult-especiais').value;
            const negativos = document.getElementById('mult-negativos').value;
            const graves = document.getElementById('mult-graves').value;
            
            systemData.multipliers.positivos = parseInt(positivos);
            systemData.multipliers.especiais = parseInt(especiais);
            systemData.multipliers.negativos = parseInt(negativos);
            systemData.multipliers.graves = parseInt(graves);
            
            saveData();
            updateActivitiesDisplay();
            showNotification('Todos os multiplicadores atualizados!');
        }

        // Update activities display
        function updateActivitiesDisplay() {
            const container = document.getElementById('activities-container');
            const categories = ['positivos', 'especiais', 'negativos', 'graves'];
            const categoryNames = {
                positivos: 'Positivos',
                especiais: 'Especiais', 
                negativos: 'Negativos',
                graves: 'Graves'
            };
            
            container.innerHTML = categories.map(category => `
                <div class="category-section ${category}">
                    <div class="category-header">
                        <h4>${categoryNames[category]}</h4>
                    </div>
                    ${systemData[currentChild].customActivities[category].map(activity => `
                        <div class="activity-item">
                            <div class="activity-info">
                                <div class="activity-name">${activity.name}</div>
                                <div class="activity-points">${activity.points} √ó ${systemData.multipliers[category]} = ${activity.points * systemData.multipliers[category]} pontos</div>
                            </div>
                            <div class="activity-actions">
                                <button class="activity-btn move" onclick="moveActivity('${category}', ${activity.id}, 'up')">‚Üë</button>
                                <button class="activity-btn move" onclick="moveActivity('${category}', ${activity.id}, 'down')">‚Üì</button>
                                <button class="activity-btn remove" onclick="addActivity('${category}', ${activity.id}, -1)">-</button>
                                <button class="activity-btn add" onclick="addActivity('${category}', ${activity.id}, 1)">+</button>
                                <button class="activity-btn edit" onclick="editActivity('${category}', ${activity.id})">‚úèÔ∏è</button>
                                <button class="activity-btn delete" onclick="deleteActivity('${category}', ${activity.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                    `).join('')}
                    <button class="add-activity-btn" onclick="showAddActivityModal('${category}')">+ Adicionar Atividade ${categoryNames[category]}</button>
                </div>
            `).join('');
        }

        // Move activity up/down
        function moveActivity(category, activityId, direction) {
            const activities = systemData[currentChild].customActivities[category];
            const index = activities.findIndex(a => a.id === activityId);
            
            if (direction === 'up' && index > 0) {
                [activities[index], activities[index - 1]] = [activities[index - 1], activities[index]];
            } else if (direction === 'down' && index < activities.length - 1) {
                [activities[index], activities[index + 1]] = [activities[index + 1], activities[index]];
            } else {
                return;
            }
            
            saveData();
            updateActivitiesDisplay();
            showNotification(`Atividade movida para ${direction === 'up' ? 'cima' : 'baixo'}!`);
        }
        
        // Add activity points (ONLY FOR TODAY)
        function addActivity(category, activityId, multiplier = 1) {
            console.log('‚ûï Adicionando pontos da atividade:', category, activityId, multiplier);
            const activity = systemData[currentChild].customActivities[category].find(a => a.id === activityId);
            if (!activity) return;
            
            // IMPORTANT: Always use today's date
            const today = new Date().toISOString().split('T')[0];
            
            // Para a√ß√µes negativas e graves, inverter a l√≥gica dos pontos
            let finalMultiplier = multiplier;
            if (category === 'negativos' || category === 'graves') {
                finalMultiplier = -multiplier; // Inverter o sinal
            }
            
            const totalPoints = activity.points * systemData.multipliers[category] * finalMultiplier;
            
            systemData[currentChild].totalPoints += totalPoints;
            systemData[currentChild].activities.push({
                name: activity.name,
                points: totalPoints,
                basePoints: activity.points,
                category: category,
                multiplier: systemData.multipliers[category],
                date: today, // Always today's date
                timestamp: new Date().toISOString()
            });
            
            saveData();
            updateDisplay();
            
            // Determinar a√ß√£o baseada no resultado final dos pontos
            let action;
            if (category === 'negativos' || category === 'graves') {
                // Para a√ß√µes negativas/graves: + perde pontos, - ganha pontos
                action = multiplier > 0 ? 'perdeu' : 'ganhou';
            } else {
                // Para a√ß√µes positivas/especiais: + ganha pontos, - perde pontos
                action = multiplier > 0 ? 'ganhou' : 'perdeu';
            }
            
            const absPoints = Math.abs(totalPoints);
            const childName = currentChild === 'luiza' ? 'Luiza' : 'Miguel';
            showNotification(`${childName} ${action} ${absPoints} pontos por: ${activity.name} (${today})`);
        }
        
        // Remove today activity (ONLY TODAY'S ACTIVITIES)
        function removeTodayActivity(index) {
            const today = new Date().toISOString().split('T')[0];
            const todayActivities = systemData[currentChild].activities.filter(a => a.date === today);
            
            if (index >= 0 && index < todayActivities.length) {
                const activity = todayActivities[index];
                const allActivitiesIndex = systemData[currentChild].activities.findIndex(a => 
                    a.timestamp === activity.timestamp
                );
                
                if (allActivitiesIndex !== -1) {
                    // Remove points from total
                    systemData[currentChild].totalPoints -= activity.points;
                    
                    // Remove activity from array
                    systemData[currentChild].activities.splice(allActivitiesIndex, 1);
                    
                    saveData();
                    updateDisplay();
                    
                    const childName = currentChild === 'luiza' ? 'Luiza' : 'Miguel';
                    showNotification(`Atividade removida para ${childName}`);
                }
            }
        }

        // Show add activity modal
        function showAddActivityModal(category) {
            document.getElementById('activity-category').value = category;
            document.getElementById('add-activity-modal').style.display = 'block';
        }

        // Save activity
        function saveActivity() {
            const name = document.getElementById('activity-name').value.trim();
            const points = parseInt(document.getElementById('activity-points').value);
            const category = document.getElementById('activity-category').value;
            
            if (!name || !points) {
                showNotification('Por favor, preencha todos os campos', 'error');
                return;
            }
            
            // Check for duplicates
            const exists = systemData[currentChild].customActivities[category].some(a => 
                a.name.toLowerCase() === name.toLowerCase()
            );
            
            if (exists) {
                showNotification('Atividade j√° existe nesta categoria', 'error');
                return;
            }
            
            // Generate new ID
            const maxId = Math.max(0, ...systemData[currentChild].customActivities[category].map(a => a.id));
            
            systemData[currentChild].customActivities[category].push({
                id: maxId + 1,
                name: name,
                points: points
            });
            
            saveData();
            updateActivitiesDisplay();
            closeModal('add-activity-modal');
            
            showNotification(`Atividade "${name}" adicionada com sucesso!`);
            
            // Clear form
            document.getElementById('activity-name').value = '';
            document.getElementById('activity-points').value = '1';
        }

        // Edit activity
        function editActivity(category, activityId) {
            const activity = systemData[currentChild].customActivities[category].find(a => a.id === activityId);
            if (!activity) return;
            
            editingActivityId = activityId;
            editingCategory = category;
            
            document.getElementById('edit-activity-name').value = activity.name;
            document.getElementById('edit-activity-points').value = activity.points;
            document.getElementById('edit-activity-category').value = category;
            
            document.getElementById('edit-activity-modal').style.display = 'block';
        }

        // Save edited activity
        function saveEditedActivity() {
            const name = document.getElementById('edit-activity-name').value.trim();
            const points = parseInt(document.getElementById('edit-activity-points').value);
            const newCategory = document.getElementById('edit-activity-category').value;
            
            if (!name || !points) {
                showNotification('Por favor, preencha todos os campos', 'error');
                return;
            }
            
            // Find and remove from old category
            const oldCategoryActivities = systemData[currentChild].customActivities[editingCategory];
            const activityIndex = oldCategoryActivities.findIndex(a => a.id === editingActivityId);
            
            if (activityIndex !== -1) {
                const activity = oldCategoryActivities[activityIndex];
                
                // Remove from old category
                oldCategoryActivities.splice(activityIndex, 1);
                
                // Add to new category (or same category with updated data)
                activity.name = name;
                activity.points = points;
                
                // If category changed, generate new ID for new category
                if (newCategory !== editingCategory) {
                    const maxId = Math.max(0, ...systemData[currentChild].customActivities[newCategory].map(a => a.id));
                    activity.id = maxId + 1;
                }
                
                systemData[currentChild].customActivities[newCategory].push(activity);
                
                saveData();
                updateActivitiesDisplay();
                updateDisplay(); // Update today's activities if needed
                closeModal('edit-activity-modal');
                
                showNotification(`Atividade "${name}" atualizada com sucesso!`);
            }
        }

        // Delete activity
        function deleteActivity(category, activityId) {
            if (confirm('Tem certeza que deseja excluir esta atividade?')) {
                const activities = systemData[currentChild].customActivities[category];
                const index = activities.findIndex(a => a.id === activityId);
                
                if (index !== -1) {
                    const activityName = activities[index].name;
                    activities.splice(index, 1);
                    
                    saveData();
                    updateActivitiesDisplay();
                    
                    showNotification(`Atividade "${activityName}" exclu√≠da`);
                }
            }
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset editing variables
            editingActivityId = null;
            editingCategory = null;
        }

        // Load reports
        function loadReports() {
            updateReports();
        }

        // Select period
        function selectPeriod(period) {
            currentPeriod = period;
            
            // Update UI
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateReports();
        }

        // Update reports
        function updateReports() {
            const now = new Date();
            let startDate;
            
            switch (currentPeriod) {
                case 'week':
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case 'month':
                    startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case '6months':
                    startDate = new Date(now.getTime() - 180 * 24 * 60 * 60 * 1000);
                    break;
                case 'year':
                    startDate = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                    break;
            }
            
            const periodActivities = systemData[currentChild].activities.filter(a => 
                new Date(a.date) >= startDate
            );
            
            // Update basic stats
            document.getElementById('period-activities').textContent = periodActivities.length;
            const totalPoints = periodActivities.reduce((sum, a) => sum + a.points, 0);
            document.getElementById('period-points').textContent = totalPoints;
            
            const days = Math.ceil((now - startDate) / (1000 * 60 * 60 * 24));
            const dailyAverage = periodActivities.length > 0 ? (totalPoints / days).toFixed(1) : 0;
            document.getElementById('daily-average').textContent = dailyAverage;
            
            // Update category analysis
            const categoryStats = {
                positivos: { count: 0, points: 0 },
                especiais: { count: 0, points: 0 },
                negativos: { count: 0, points: 0 },
                graves: { count: 0, points: 0 }
            };
            
            periodActivities.forEach(activity => {
                if (categoryStats[activity.category]) {
                    categoryStats[activity.category].count++;
                    categoryStats[activity.category].points += activity.points;
                }
            });
            
            // Create category analysis with proper colors
            const categoryPoints = Object.keys(categoryStats).map(category => {
                const categoryPoints = categoryStats[category].points;
                return {
                    category: category,
                    count: categoryStats[category].count,
                    points: categoryPoints
                };
            });
            
            document.getElementById('category-analysis').innerHTML = `
                <div class="stat-item">
                    <h5 style="color: #4CAF50;">Positivos</h5>
                    <div class="value">${categoryStats.positivos.count} atividades</div>
                    <div style="font-size: 0.9rem; color: #666;">${categoryStats.positivos.points} pontos</div>
                </div>
                <div class="stat-item">
                    <h5 style="color: #2196F3;">Especiais</h5>
                    <div class="value">${categoryStats.especiais.count} atividades</div>
                    <div style="font-size: 0.9rem; color: #666;">${categoryStats.especiais.points} pontos</div>
                </div>
                <div class="stat-item">
                    <h5 style="color: #F44336;">Negativos</h5>
                    <div class="value">${categoryStats.negativos.count} atividades</div>
                    <div style="font-size: 0.9rem; color: #666;">${categoryStats.negativos.points} pontos</div>
                </div>
                <div class="stat-item">
                    <h5 style="color: #9C27B0;">Graves</h5>
                    <div class="value">${categoryStats.graves.count} atividades</div>
                    <div style="font-size: 0.9rem; color: #666;">${categoryStats.graves.points} pontos</div>
                </div>
            `;
            
            // Update chart
            updateChart(periodActivities, startDate, now);
            
            // Update top activities
            updateTopActivities(periodActivities);
        }

        // Update chart (simplified version using Canvas)
        function updateChart(activities, startDate, endDate) {
            const canvas = document.getElementById('evolution-chart');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = 300;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (activities.length === 0) {
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Nenhuma atividade no per√≠odo selecionado', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // Group activities by date
            const dailyPoints = {};
            activities.forEach(activity => {
                if (!dailyPoints[activity.date]) {
                    dailyPoints[activity.date] = 0;
                }
                dailyPoints[activity.date] += activity.points;
            });
            
            // Convert to array and sort by date
            const dataPoints = Object.entries(dailyPoints)
                .map(([date, points]) => ({ date: new Date(date), points }))
                .sort((a, b) => a.date - b.date);
            
            if (dataPoints.length === 0) return;
            
            // Calculate chart dimensions
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // Find min/max values
            const maxPoints = Math.max(...dataPoints.map(d => d.points));
            const minPoints = Math.min(...dataPoints.map(d => d.points));
            const pointsRange = maxPoints - minPoints || 1;
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw data line
            if (dataPoints.length > 1) {
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                dataPoints.forEach((point, index) => {
                    const x = padding + (index / (dataPoints.length - 1)) * chartWidth;
                    const y = canvas.height - padding - ((point.points - minPoints) / pointsRange) * chartHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
            }
            
            // Draw data points
            ctx.fillStyle = '#667eea';
            dataPoints.forEach((point, index) => {
                const x = padding + (index / Math.max(1, dataPoints.length - 1)) * chartWidth;
                const y = canvas.height - padding - ((point.points - minPoints) / pointsRange) * chartHeight;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // Draw labels
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            
            // Y-axis labels
            for (let i = 0; i <= 5; i++) {
                const value = minPoints + (pointsRange * i / 5);
                const y = canvas.height - padding - (i / 5) * chartHeight;
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(value), padding - 10, y + 4);
            }
            
            // X-axis labels (show first, middle, and last dates)
            if (dataPoints.length > 0) {
                ctx.textAlign = 'center';
                const firstDate = dataPoints[0].date.toLocaleDateString('pt-BR');
                const lastDate = dataPoints[dataPoints.length - 1].date.toLocaleDateString('pt-BR');
                
                ctx.fillText(firstDate, padding, canvas.height - padding + 20);
                ctx.fillText(lastDate, canvas.width - padding, canvas.height - padding + 20);
                
                if (dataPoints.length > 2) {
                    const middleIndex = Math.floor(dataPoints.length / 2);
                    const middleDate = dataPoints[middleIndex].date.toLocaleDateString('pt-BR');
                    ctx.fillText(middleDate, canvas.width / 2, canvas.height - padding + 20);
                }
            }
        }

        // Update top activities
        function updateTopActivities(activities) {
            const activityCounts = {};
            
            activities.forEach(activity => {
                if (!activityCounts[activity.name]) {
                    activityCounts[activity.name] = 0;
                }
                activityCounts[activity.name]++;
            });
            
            const topActivities = Object.entries(activityCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            document.getElementById('top-activities').innerHTML = topActivities.length > 0 ? 
                topActivities.map(([name, count], index) => 
                    `<div>${index + 1}. ${name} (${count}x)</div>`
                ).join('') : 
                'Nenhuma atividade registrada';
        }

        // Load system stats
        function loadSystemStats() {
            const totalActivities = systemData.luiza.activities.length + systemData.miguel.activities.length;
            const luizaTotal = systemData.luiza.activities.length;
            const miguelTotal = systemData.miguel.activities.length;
            
            const luizaCustom = Object.values(systemData.luiza.customActivities).reduce((sum, cat) => sum + cat.length, 0);
            const miguelCustom = Object.values(systemData.miguel.customActivities).reduce((sum, cat) => sum + cat.length, 0);
            
            document.getElementById('system-stats').innerHTML = `
                <strong>Total de registros:</strong> ${totalActivities}<br>
                <strong>Luiza:</strong> ${luizaTotal} registros, ${systemData.luiza.totalPoints} pontos<br>
                <strong>Miguel:</strong> ${miguelTotal} registros, ${systemData.miguel.totalPoints} pontos<br>
                <strong>Atividades cadastradas:</strong> ${luizaCustom} (Luiza), ${miguelCustom} (Miguel)<br>
                <strong>Multiplicadores:</strong> <span style="color: #4CAF50;">Positivos(${systemData.multipliers.positivos}x)</span>, <span style="color: #2196F3;">Especiais(${systemData.multipliers.especiais}x)</span>, <span style="color: #F44336;">Negativos(${systemData.multipliers.negativos}x)</span>, <span style="color: #9C27B0;">Graves(${systemData.multipliers.graves}x)</span><br>
                <strong>Data atual:</strong> ${new Date().toLocaleDateString('pt-BR')}
            `;
        }

        // Backup functions
        async function selectBackupFolder() {
            try {
                if ('showDirectoryPicker' in window) {
                    backupFolderHandle = await window.showDirectoryPicker({
                        mode: 'readwrite'
                    });
                    
                    updateBackupStatus('Pasta selecionada: ' + backupFolderHandle.name);
                    showNotification('Pasta de backup selecionada com sucesso!');
                    
                    // Start auto backup
                    startAutoBackup();
                } else {
                    showNotification('Seu navegador n√£o suporta sele√ß√£o de pasta. Use exportar/importar.', 'error');
                }
            } catch (error) {
                console.error('Erro ao selecionar pasta:', error);
                showNotification('Erro ao selecionar pasta de backup', 'error');
            }
        }

        function startAutoBackup() {
            if (backupInterval) {
                clearInterval(backupInterval);
            }
            
            const intervalMs = parseInt(document.getElementById('backup-interval').value) * 1000;
            
            backupInterval = setInterval(async () => {
                await autoBackupToFolder();
            }, intervalMs);
        }

        async function autoBackupToFolder() {
            if (!backupFolderHandle) return;
            
            try {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const filename = `sistema-pontos-backup-${timestamp}.json`;
                
                const fileHandle = await backupFolderHandle.getFileHandle(filename, {
                    create: true
                });
                
                const writable = await fileHandle.createWritable();
                await writable.write(JSON.stringify(systemData, null, 2));
                await writable.close();
                
                updateBackupStatus(`√öltimo backup: ${new Date().toLocaleString('pt-BR')}`);
            } catch (error) {
                console.error('Erro no backup autom√°tico:', error);
            }
        }

        function manualBackup() {
            if (backupFolderHandle) {
                autoBackupToFolder();
                showNotification('Backup manual realizado!');
            } else {
                showNotification('Selecione uma pasta de backup primeiro', 'error');
            }
        }

        function setBackupInterval(seconds) {
            if (backupFolderHandle) {
                startAutoBackup();
                showNotification(`Intervalo de backup alterado para ${seconds} segundos`);
            }
        }

        function updateBackupStatus(message) {
            document.getElementById('backup-status').innerHTML = `
                <strong>Status:</strong> ${message}<br>
                <strong>√öltimo backup:</strong> ${new Date().toLocaleString('pt-BR')}
            `;
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(systemData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `sistema-pontos-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Dados exportados com sucesso!');
        }

        // Import data
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (importedData.luiza && importedData.miguel && importedData.multipliers) {
                        systemData = importedData;
                        saveData();
                        updateDisplay();
                        updateActivitiesDisplay();
                        showNotification('Dados importados com sucesso!');
                    } else {
                        showNotification('Arquivo inv√°lido', 'error');
                    }
                } catch (error) {
                    showNotification('Erro ao importar dados', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('sistema-pontos-data', JSON.stringify(systemData));
                console.log('üíæ Dados salvos no localStorage');
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                showNotification('Erro ao salvar dados', 'error');
            }
        }

        // Load data from localStorage
        function loadData() {
            try {
                const savedData = localStorage.getItem('sistema-pontos-data');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    // Merge with default structure to ensure all properties exist
                    systemData = {
                        ...systemData,
                        ...parsedData,
                        luiza: { ...systemData.luiza, ...parsedData.luiza },
                        miguel: { ...systemData.miguel, ...parsedData.miguel },
                        multipliers: { ...systemData.multipliers, ...parsedData.multipliers }
                    };
                    
                    console.log('üìÇ Dados carregados do localStorage');
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showNotification('Erro ao carregar dados salvos', 'error');
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Initialize system when page loads
        document.addEventListener('DOMContentLoaded', initSystem);
    </script>
</body>
</html>
